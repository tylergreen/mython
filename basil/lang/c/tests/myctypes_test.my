#! /usr/bin/env mython
# ______________________________________________________________________
"""myctypes_test.my - Test the myctypes quotation function for use
with Mython.

Jonathan Riehl

$Id$
"""
# ______________________________________________________________________
# Module imports

# Note this requires implementation of compile-time importation.

import ctypes
from basil.lang.c import myctypes

# XXX Might want to ensure mycmodule.so or mycmodule.dll exists
# already.  Is there some way to leverage distutils, but only within
# the scope of this test?

quote [myctypes] mycmodule:
    int increment;
    int inc (int a);

# XXX Can we add any compile time checks that this generates the
# proper interface?

if __name__ == "__main__":
    inc_result = mycmodule.inc(22)
    assert inc_result == (22 + mycmodule.increment)
    try:
        mycmodule.inc("Number bummer.")
        assert False
    except ctypes.ArgumentError:
        pass
    print "Good myctypes!"

# ______________________________________________________________________
# End of myctypes_test.my
